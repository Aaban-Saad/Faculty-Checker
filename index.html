<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0, user-scalable=no">
    <title>Faculty Checker</title>
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
</head>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Roboto";
        color: white;
        text-align: center;
    }

    body {
        background-color: rgb(27, 27, 27);
    }

    h1 {
        font-size: 45px;
        font-weight: 300;
        margin-bottom: 20px;
    }

    h2 {
        color: rgb(230, 230, 230);
        font-weight: 400;
        margin-bottom: 10px;
    }

    h3 {
        margin-top: 10px;
    }

    p {
        color: rgb(206, 206, 206);
    }

    img {
        margin-top: 20px;
    }

    @media screen and (max-width: 1050px) {
        img {
            width: 200px;
        }
    }

    input {
        padding: 10px;
        border-radius: 10px;
        margin-top: 10px;
        color: black;
    }

    .common-btn {
        padding: 10px 20px 10px 20px;
        background-color: rgb(17, 170, 17);
        border-radius: 10px;
        border: none;
        cursor: pointer;
        margin-top: 20px;
        font-size: large;
    }

    .common-btn:hover {
        background-color: rgb(15, 148, 15);
    }

    .main-container {
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    .sub-container {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        padding: 30px 10px 30px 10px;
        margin-top: 25px;
        width: 100%;
        border-radius: 10px;
        box-shadow: rgb(0, 0, 0) 0px 10px 30px 1px;
        background-color: rgb(44, 44, 44);
    }

    .sub-container-2 {
        height: 40vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    footer {
        background: #333;
        color: #fff;
        padding: 50px 0;
    }
</style>

<body>
    <div class="main-container">
        <h1>Faculty Checker</h1>
        <h2>Summer 2024 Release</h2>
        <p>Predict faculty initials with ease.</p>
        <div class="sub-container">
            <h2>Download Now</h2>
            <p>Currently available for Windows only</p>
            <button class="common-btn" id="download-btn">Windows 64</button>
        </div>

        <div class="sub-container-2">
            <h2 style="margin-top: 30px;">Disclaimer</h2>
            <h4>
                Faculty Checker is a free and non-profit software. Users need to authenticate using their Google account to download the software. We do not collect, store, or transmit any user data, including passwords, once the software is downloaded. Use at your own risk.
            </h4>
        </div>
    </div>
    <footer>
        <div class="container">
            <img style="width: 50px;" src="logo.png" alt="">
            <p style="margin-top: 20px; margin-bottom: 20px;">&copy; 2024 Faculty Checker. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCq7t59BteQAfawQ4_ZCqHJGbWDwbbMbUs",
            authDomain: "faculty-checker.firebaseapp.com",
            projectId: "faculty-checker",
            storageBucket: "faculty-checker.appspot.com",
            messagingSenderId: "667238061191",
            appId: "1:667238061191:web:c32340eaea43d257f5d422",
            databaseURL: "https://faculty-checker-default-rtdb.asia-southeast1.firebasedatabase.app",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const db = getDatabase();

        // Function to convert timestamp to Dhaka time
        const convertToDhakaTime = (isoString) => {
            const date = new Date(isoString);
            return new Intl.DateTimeFormat('en-US', {
                timeZone: 'Asia/Dhaka',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }).format(date);
        };

        // Handle the button click
        document.getElementById('download-btn').addEventListener('click', async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                console.log('User signed in:', user);
                const timestamp = new Date().toISOString();
                const dhakaTime = convertToDhakaTime(timestamp)
                
                // Store user data in FireBase
                await set(ref(db, 'users/' + user.uid), {
                    name: user.displayName,
                    email: user.email,
                    photoURL: user.photoURL,
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    timestamp: dhakaTime,
                });

                // Download the file
                const link = document.createElement('a');
                link.href = 'https://drive.google.com/uc?export=download&id=1Hm4-AGjQ07WjQYLOJlgHe8I6rPFTwP-y';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                // Handle errors here
                console.error('Error during sign in or data storage:', error);
            }
        });
    </script>
</body>

</html>